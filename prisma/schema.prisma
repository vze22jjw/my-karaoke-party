// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DATABASE_URL_NON_POOLING")
}

model Video {
    id        String   @id
    title     String
    artist    String
    song      String
    coverUrl  String
    createdAt DateTime @default(now())
    duration  String
}

model Party {
    id             Int            @id @default(autoincrement())
    hash           String?        @unique
    name           String
    createdAt      DateTime       @default(now())
    lastActivityAt DateTime       @default(now())
    orderByFairness Boolean        @default(true)
    disablePlayback Boolean        @default(false)
    playlistItems  PlaylistItem[]
    participants   PartyParticipant[]

    currentSongId                String?
    currentSongStartedAt         DateTime?
    currentSongRemainingDuration Int?
    status         String         @default("OPEN") // OPEN, STARTED, CLOSED
    idleMessages   String[]       @default([]) 
    themeSuggestions String[]     @default([]) 
    spotifyPlaylistId String?

    @@index([hash])
    @@index([lastActivityAt])
    @@index([status])
}

model PartyParticipant {
    id        Int           @id @default(autoincrement())
    partyId   Int
    party     Party         @relation(fields: [partyId], references: [id], onDelete: Cascade)
    name      String
    joinedAt  DateTime      @default(now())
    role      String        @default("Guest") 
    applauseCount Int       @default(0)
    avatar    String?       // Will store an emoji or icon identifier
    @@unique([partyId, name])
    @@index([partyId])
}

model PlaylistItem {
    id         Int       @id @default(autoincrement())
    partyId    Int
    party      Party     @relation(fields: [partyId], references: [id], onDelete: Cascade)
    videoId    String
    title      String
    artist     String?
    song       String?
    coverUrl   String
    duration   String?
    singerName String
    addedAt    DateTime  @default(now())
    playedAt   DateTime?
    orderIndex Int       @default(0)
    randomBreaker Float?
    spotifyId  String?

    @@index([partyId])
    @@index([playedAt])
}

model IdleMessage {
  id        Int      @id @default(autoincrement())
  hostName  String
  message   String
  createdAt DateTime @default(now())
  @@index([hostName])
}
