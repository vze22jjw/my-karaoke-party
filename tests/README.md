# Automated End-to-End Testing üé≠

This directory contains the robust **Playwright** test suite for **My Karaoke Party**. 
It simulates a real-world party environment with multiple simultaneous users (Host, Guest, Player) to ensure the entire flow works correctly.

---

## üß™ What These Tests Do

The primary test suite (`core-flow.spec.ts`) runs a comprehensive "Party Lifecycle" scenario using **Serial Mode** (steps depend on each other):

1.  **üëë Host (Desktop):** * Starts a new party with a unique name (e.g., "User Party 123").
    * **Smart Tour Handling:** Automatically detects and dismisses blocking "New User" tours.
    * Manages playback settings and closes the party.
2.  **üì± Guest (Mobile):** * Joins via the party code generated by the Host.
    * Searches for and adds multiple songs to the shared queue.
3.  **üì∫ Player (TV):** * Connects to the session.
    * Verifies the "Waiting" screen, "Now Playing" video, and "Up Next" overlay.

### üõ°Ô∏è Safety & Cleanup Strategy
These tests are designed to be **safe for production**.
* **Unique Data:** Every run creates a uniquely named party.
* **Targeted Cleanup:** The test captures the specific `partyHash` it created and calls a secure API endpoint (`DELETE /api/admin/party/delete`) to remove *only* that party after the test finishes (pass or fail).

---

## üìÇ Artifacts & Reporting (Unified)

We use a **unified reporting structure** to prevent file clutter. Every test run creates a **single, unique timestamped folder** (precision to the minute) containing all assets.

**Directory Pattern:** `playwright-report/run-YYYY-MM-DD-HH-mm/`

Inside this folder, you will find:
* üìÑ **`report/index.html`**: The full HTML test report.
* üé• **`videos/`**: Continuous screen recordings of the Host, Guest, and Player sessions.
* üì∏ **`screenshots/`**: PNG snapshots taken at key moments (e.g., `01-player-connected.png`).
* üîç **`trace/`**: Debug traces for detailed failure analysis.

> **Note:** The timestamp format avoids milliseconds to ensure the Test Runner and the Config file always resolve to the exact same folder.

---

## ‚öôÔ∏è Configuration

The test suite relies on environment variables to know where to point and how to authenticate.

**Required Variables:**
* `BASE_URL`: The full URL of the app to test (e.g., `http://localhost:3000` or `https://mykaraoke.party`).
* `ADMIN_TOKEN`: The admin password used to create/manage parties (must match the server's `ADMIN_TOKEN`).

**Timeout Strategy:**
The suite uses generous timeouts (5s pauses between major actions) to simulate a "thoughtful" user and allow for network latency on production servers.

---

## üöÄ How to Run

### 1. Local Development
Ensure your local app is running (usually on port 3000).

```bash
# Run the test suite
npx playwright test


```bash
# Run in docker changing your sit url in compose file prior to running.
docker compose -f tests/docker-compose.test.yml up --build --abort-on-container-exit


```bash
# Run load 30 user test by changing docker compose and running same command
docker compose -f tests/docker-compose.test.yml up --build --abort-on-container-exit
