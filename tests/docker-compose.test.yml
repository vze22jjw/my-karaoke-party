---
version: '3.8'

services:
  playwright:
    image: mcr.microsoft.com/playwright:v1.57.0-jammy
    container_name: mykaraoke-e2e
    working_dir: /app
    shm_size: '4gb'
    environment:
      - BASE_URL=${BASE_URL}
      - ADMIN_TOKEN=${ADMIN_TOKEN}
      - CI=true
    volumes:
      - ..:/app
      - /app/node_modules
      - /app/.pnpm-store
    networks:
      - my-karaoke-party_mykaraokenetwork
    command: >
      /bin/sh -c "
      npm install -g pnpm &&
      pnpm install &&
      ${TEST_COMMAND:-npx playwright test}"

networks:
  my-karaoke-party_mykaraokenetwork:
    external: true
