---
version: '3.8'

services:
  playwright:
    image: mcr.microsoft.com/playwright:v1.57.0-jammy
    container_name: mykaraoke-e2e
    working_dir: /app
    ipc: host
    environment:
      - BASE_URL=http://mykaraoke-app:3000
      - ADMIN_TOKEN=change-this
      - CI=true
    volumes:
      - ..:/app
      - /app/node_modules
      - /app/.pnpm-store
    networks:
      - my-karaoke-party_mykaraokenetwork
    command: >
      /bin/sh -c "
      env &&
      npm install -g pnpm &&
      pnpm install &&
      npx playwright test"
      ### use this line to run 30 user load test file
      #npx playwright test tests/load-test.spec.ts --workers=1"

networks:
  my-karaoke-party_mykaraokenetwork:
    external: true
    # Update this name if your main project folder isn't 'my-karaoke-party'
    # Run `docker network ls` to check the actual name.
    # name: my-karaoke-party_mykaraokenetwork
